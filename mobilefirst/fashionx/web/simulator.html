<html>
<head>

<title>Fashion Simulator</title>

<!-- Eclipse Paho MQTT -->
<script src="script/mqttws31.js" type="text/javascript"></script>    

<!-- Application -->
<script type="text/javascript">
// Constant
var FASHION_CLIENT = 'd:wkqwsd:Edison:FashionFinder';
var FASHION_FINDER = 'wkqwsd.messaging.internetofthings.ibmcloud.com';
var FASHION_KEY = 'use-token-auth';
var FASHION_PORT = 1883;
var FASHION_TOPIC = 'iot-2/evt/weather/fmt/json';
var FASHION_RATE = 5000;
var FASHION_TOKEN = 'Usd(i_COmfY3)Y9Xhs';
    
// Application
var client = null;
var interval = null;    
    
function update() {
    var data = null;
    var message = null;
    var temperature = null;
    
    temperature = Math.random() * 100;
    
    data = {
        d: {
            fahrenheit: parseFloat( ( temperature ).toFixed( 2 ) ),
            celcius: parseFloat( ( ( temperature - 32 ) * ( 5 / 9 ) ).toFixed( 2 ) ),
            humidity: parseFloat( ( Math.random() * 100 ).toFixed( 2 ) ),
            pressure: 0,
            light: 0,
            latitude: 0,
            longitude: 0,
            speed: 0,
            direction: 0,
            rain: 0
        }
    };
    
    message = new Paho.MQTT.Message( JSON.stringify( data ) );
    message.destinationName = FASHION_TOPIC;
    
    client.send( message );    
}
    
function doFashionConnect( context ) {
    // Debug
    console.log( 'Fashion connect.' );
    
    // Update regularly
    setInterval( update, FASHION_RATE );
    update();
}
    
function doFashionSent( message ) {
    // Debug
    console.log( 'Fashion sent.' );
}
    
function doWindowLoad() {
    // Debug
    console.log( 'Window load.' );
    
    // Paho
    client = new Paho.MQTT.Client( FASHION_FINDER, FASHION_PORT, FASHION_CLIENT );
    client.onMessageDelivered = doFashionSent;
    client.connect( {
        userName: FASHION_KEY,
        password: FASHION_TOKEN,
        onSuccess: doFashionConnect    
    } );
}
    
// Go
window.addEventListener( 'load', doWindowLoad );
</script>
    
<head>
<body>



</body>
</html>
